<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<script type="text/javascript" src="template"></script>
<script src=" http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=3168919025" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
var xn = {};
xn.use = function() {
	var arr = [];
	for ( var i = 0, il = arguments.length; i < il; i++) {
		arr.push(arguments[i]);
	}
	xn._cache_use.push(arr);
};
xn.create = function() {
	var arr = [];
	for ( var i = 0, il = arguments.length; i < il; i++) {
		arr.push(arguments[i]);
	}
	xn._cache_create.push(arr);
};
xn._cache_use = new Array();
xn._cache_create = new Array();
xn.config = {
	_path : {
		"core-beta.Class" : {
			path : 'lib/core-beta/Class.js',
			requires : [ "loader_test.A", "loader_test.B" ]
		},
		"loader_test.A" : {
			path : "lib/loader_test/A.js"
		},
		"loader_test.B" : {
			path : "lib/loader_test/B.js"
		}
	}
};
var script = document.createElement('script');
script.src = 'lib/core-beta/Loader.js';
document.getElementsByTagName('head')[0].appendChild(script);

</script>
<title>信念</title>
</head>
<body>
追逐梦想，热爱生活
<div id="weather"></div>
<div id="books"></div>

<script type="text/javascript">
xn.use(["loader_test.OAuthInner","loader_test.SQLite","loader_test.IndexedDB","loader_test.XHR2"],function(OAuth,SQLite,IndexedDB,XHR2){
	/*   var oauth = new OAuth();
	  oauth.checkLogin(function(data){
		  
		  document.querySelector("section.login_message").innerHTML=examples.simple.userMessage(data);
		  
		  oauth.friendsGet(function(data){
			  SQLite.prepareDatabase(function(db){
				  //存储好友信息				  
				  //SQLite.saveFriends(data.friend_list);
				  console.log(data.friend_list);
			  },function(event){
				  console.log("error"+event.message);
			  }); 
			  document.querySelector("section.searchFriend").innerHTML = xnTemplate.sdk.searchFirends(data);
		  });
		  	
		  oauth.feedGet(function(data){
				 
			   SQLite.prepareDatabase(function(db){					  
					  //SQLite.saveFeed(data.feed_list);
				  },function(event){
					  console.log("error"+event.message);
				  }); 
			   console.log(data.feed_list);
			   document.querySelector("section.feed_list").innerHTML=examples.simple.feed(data); 
		  }); 
		  
	  });  */
	  
	  //var url = "https://www.googleapis.com/books/v1/volumes?q=harry+potter&callback=handleResponse";
	  var books = document.querySelector("#books");
	  var url="https://accounts.google.com/o/oauth2/auth?"+
		  "scope=https://www.googleapis.com/auth/userinfo.profile"+
		  "+https://www.googleapis.com/auth/plus.me"+
		  "+https://www.googleapis.com/auth/tasks"+
		  "+https://www.googleapis.com/auth/userinfo.email&"+
		  "state=/profile&"+
		  "redirect_uri=http://mc1.test.renren.com/mlogin/xn_api_test/oauth2callback.html&"+
		  "response_type=token&"+
		  "client_id=1000630186960.apps.googleusercontent.com";
	  var login = document.createElement('a');
	  login.href = url;
	  login.target="_blank";
	  login.innerHTML = "登录";
	  document.body.insertBefore(login,books);
	  
	  var url = "https://www.googleapis.com/books/v1/volumes?q=harry+potter";
	  var xhr2 =new XHR2({
			url:url,
			method:"get",
			withCredentials:false,
			data:null,
			success:function(response){
				console.log(response);
				var result = xn_template.google.books({books:response});
				
				books.innerHTML = result;
			},
			failure:function(response){				
				alert("error");
			}
		}); 
	  //获取字库
	  /* var xhr=new XHR2({
			url:"http://t.comicsand.com/manifest/pinyin.php",
			method:"post",
			data:null,
			success:function(response){
				//使用这种存储方式，消耗时间 51396 ms
				SQLite.prepareDatabase(function(db){
					  var array = new Array();
					  for(var i in response){
						  array.push({key:i,value:response[i]});
					  }
					  console.log("sqllite startTime======"+new Date().getTime());
					  SQLite.savePinyin(array);
				  },function(event){
					  console.log("error"+event.message);
				  });
				
				  //indexedDB 消耗时间 2237 ms
				  var indexedDB = new IndexedDB("test",function(event){
					  console.log(new Date().getTime()+"============开始时间");
					  indexedDB.save(response);
					 },function(event){
						 alert("error");
					 });
			},
			failure:function(response){
				alert("请求失败");
			}
		});	
	  */
	  
	  
	/*  SQLite.prepareDatabase(function(db){
		  
		  SQLite.searchWord("马",function(data){
			  console.log(data);
		  });
	  },function(event){
		  console.log("error"+event.message);
	  });*/
	  
	  if(navigator.geolocation){
		     // get the current position
		      navigator.geolocation.getCurrentPosition(
		   
		     // if this was successful, get the latitude and longitude
		     function(position){
		       var lat = position.coords.latitude;
		       var lon = position.coords.longitude;
		       
		    },
		    // if there was an error
		     function(error){
		      alert('ouch');
		    });
		}
	  function getWeather(woeid){
		  var weatherURL = "weather?w={woeid}&u=c";
		  var xhr2 =new XHR2({
				url:weatherURL.replace("{woeid}",woeid),
				method:"get",
				withCredentials:false,
				data:{
					format:"json"
				},
				format:"xml",
				success:function(response){
					console.log(response);
					var condition = response.querySelectorAll("condition")[0];
					var attributes = condition.attributes;
					
					response.childNodes[0].querySelectorAll("rss *|condition");
					for (var i = attributes.length-1;i>=0;i--){ 
						
						var attribute = attributes[i];
						console.log(attribute.nodeName+"====="+attribute.value);
					}
					var weatherEle = document.querySelector("#weather");
					
					weatherEle.innerHTML = response.querySelector("rss channel item description").textContent;
				},
				failure:function(response){				
					alert("error");
				}
			});
		  
	  }
	  getWeather("2151330");  
});
/* WB2.login(function(){
	//callback function
    console.log("success");	 
}); */
</script>


</body>
</html>